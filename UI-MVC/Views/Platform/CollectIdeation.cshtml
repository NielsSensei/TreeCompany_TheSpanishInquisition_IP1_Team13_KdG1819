@using Domain.Identity
@using Domain.UserInput
@using Domain.Users
@using Microsoft.AspNetCore.Identity
@using Microsoft.EntityFrameworkCore
@using UIMVC.Services
@model Domain.Projects.Ideation
@inject UserService Userservice
@inject QuestionService Questionservice
@inject RoleService RoleService

@{
    Layout = "_Layout";
    ViewData["Title"] = Model.Title;
}

@section Scripts
{
    <script type="module" src="~/dist/bootstrap_js.entry.js" defer></script>
}

<section class="container">
    <section class="row">
        <div class="col-5">
            <h2>@Model.Title</h2>
            <p>door @Userservice.CollectUserName(Model.User.Id)</p>
            @Html.Partial("_ReactionNumbersPartial", new LikeViewModel()
            {
                likeCount = Model.LikeCount, fbLikeCount = Model.FbLikeCount, twitterLikeCount = Model.TwitterLikeCount,
                shareCount = Model.ShareCount, retweetCount = Model.RetweetCount, iconStyle = 3
            })
            <p>@Model.ExtraInfo</p>
            @if (User.Identity.IsAuthenticated && RoleService.IsAdmin(User).Result)
            {
                <button class="btn btn-primary" id="activateMenu">Verwijder deze ideation</button>
            }
            @if (Model.Event.Id != 0)
            {
                @* TODO Zorgt voor een eventPagina *@
                <p>Deze ideation is georganiseerd dankzij dit evenement</p>
            }
            <section>
                <h6 class="font-weight-bold">Tags:</h6>

                <div class="row justify-content-start">
                    @if (Model.Tags.Any())
                    {
                        @Html.Partial("_TagsPartial", Model.Tags)
                    }
                    else
                    {
                        <p>Geen tags gevonden</p>
                    }

                    @if (User.Identity.IsAuthenticated && RoleService.IsAdmin(User).Result)
                    {
                        <a class="btn btn-primary mx-1 m-0" data-toggle="modal" data-target="#addTagModal">
                                                Nieuwe Tag</a>
                    }

                </div>
            </section>
        </div>
        <div class="col-7">
            @* TODO vervang images door Media *@
            <img alt="IdeationMedia" src="https://via.placeholder.com/600x400"/>
        </div>
    </section>
    <hr>
    <section class="container">
        <div class="row justify-content-between">
            <div>
                @if (Questionservice.CollectIdeationQuestions(Model.Id).Count == 0)
                {
                    <h1>Geen centrale vragen gesteld, wat jammer.</h1>
                }

                @if (Questionservice.CollectIdeationQuestions(Model.Id).Count == 1)
                {
                    <h1>1 centrale vraag</h1>
                }

                @if (Questionservice.CollectIdeationQuestions(Model.Id).Count > 1)
                {
                    <h1>@Questionservice.CollectIdeationQuestions(Model.Id).Count centrale vragen</h1>
                }
            </div>
            @if (User.Identity.IsAuthenticated && RoleService.IsAdmin(User).Result)
            {
                <a class="btn btn-primary h-25" method="get" asp-controller="Moderation" asp-action="AddCentralQuestion"
                   asp-route-ideation="@Model.Id">
                    Stel een nieuwe centrale vraag
                </a>
            }
        </div>
        <section class="card-columns">
            @foreach (IdeationQuestion iq in Questionservice.CollectIdeationQuestions(Model.Id))
            {
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">@iq.QuestionTitle</h5>
                        <p class="card-text">@iq.Description</p>
                        @if (iq.SiteURL != null)
                        {
                            <p>Meer info: <a href="">@iq.SiteURL</a></p>
                        }
                    </div>
                    <div class="card-footer text-center">
                        <a class="btn btn-primary" asp-controller="Platform" asp-action="CollectIdeationThread" asp-route-id="@iq.Id">Ga naar Thread</a>
                    </div>
                </div>
            }
        </section>
    </section>
</section>
<hr/>
<div class="container">
    <div class="row">
        <div class="col-md-6">
            <a class="btn btn-primary" formmethod="get" asp-controller="Moderation" asp-action="ChangeIdeation"
                    asp-route-id="@Model.Id">Pas deze ideation aan.</a>
        </div>
        <div class="col-md-6">
            <button type="button" class="btn btn-primary" data-toggle="modal" 
                    data-target="#deleteIdeationModal">Verwijder deze ideation.
            </button>
        </div>
    </div>
</div>

<div class="modal fade" id="deleteIdeationModal" tabindex="-1" role="dialog" 
     aria-labelledby="deleteIdeationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5>Ben je zeker dat je deze ideation wil verwijderen?</h5>
            </div>
            <div class=modal-body>
                <a type="button" class="btn btn-primary" asp-controller="Moderation"
                        asp-action="DestroyIdeation" asp-route-id="@Model.Id">Bevestig</a>  
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>  
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="addTagModal" tabindex="-1" role="dialog" 
     aria-labelledby="addTagModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class=modal-body>
                <form asp-controller="Moderation" asp-action="AddTag" asp-route-ideation="@Model.Id">
                    <div class="form-group">
                        <label>IdeationID</label>
                        <input disabled value="@Model.Id" class="form-control"/>
                    </div>
                    <div class="form-group">
                        <label>Vul hier de tag in:</label>
                        @Html.TextBox("GetMeATag","", 
                            new { @class="form-control"})
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-primary" type="submit">Bevestig</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button> 
                    </div>
                </form>  
            </div>
        </div>
    </div>
</div>
