@using Domain.Identity
@using Domain.UserInput
@using Microsoft.AspNetCore.Identity
@model Domain.UserInput.IdeationQuestion
@inject UIMVC.Services.ProjectService ProjectService
@inject UIMVC.Services.UserService UserService
@inject UserManager<UIMVCUser> UserManager

@{
    ViewData["Title"] = Model.QuestionTitle;
}

@section Tags
{
    <script type="module" src="~/dist/reportidea.entry.js" defer></script>
}

@section Scripts
{
    <script type="module" src="~/dist/bootstrap_js.entry.js" defer></script>
}

<div class="container"> 
    <div class="row">
        <div class="col-12">
            <h1>Ideation Thread</h1>
            <p class="font-weight-bold">@Model.QuestionTitle</p>
            <p>@Model.Description</p>
            @if (Model.SiteURL != null)
            {
                <p>Lees meer: <a href="">@Model.SiteURL</a></p>
            }
            <br/>
            <a class="btn btn-primary" asp-controller="Platform" asp-action="CollectIdeation"
               asp-route-id="@Model.Ideation.Id">Terug Naar Ideation</a>
        </div>
    </div>
    <hr/>
    <p>@ProjectService.CollectThreadIdeas(Model).Count() ideeÃ«n, heb jij er nog een?</p>
    @Html.Partial("Thread/_AddIdea", new AddIdeaModel(){ IdeationQuestionID = Model.Id, ParentID = 0})
    <br/>
    <p>@ViewData["Message"]</p>
    <hr/>
    @foreach (Idea idea in ProjectService.CollectThreadIdeas(Model).Where(i => i.ParentIdea.Id == 0))
    {
        @Html.Partial("Thread/_CollectIdea", new IdeaViewModel(){ ToView = idea, IdeaLevel = 0 })
        <hr/>
    }
</div>
<div id="Reportmenu">
    <div class="row">
        <div class="col-md-10">
            <div class="row">
                <label>Reden van de rapportering:</label>
                @Html.TextBox("Reason", "", new { @class = "form-control"})
                <a id="bevestigReport" asp-controller="Platform" asp-action="AddReport" type="button" 
                   class="btn btn-primary" asp-route-flagger="@UserManager.GetUserId(User)"
                   asp-route-thread="@Model.Id">Rapporteer</a>
                <button type="button" class="btn btn-secondary" id="closeReport">Annuleren</button>
            </div>
        </div>
    </div>
</div>